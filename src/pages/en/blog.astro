---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../i18n/ui';
const lang = 'en';
const t = useTranslations(lang);

const PER_PAGE = 7;
const allPosts = (await getCollection('blog', ({ data, slug }) => !data.draft && slug.startsWith('en/')))
  .sort((a, b) => new Date(b.data.pubDate || b.data.date).getTime() - new Date(a.data.pubDate || a.data.date).getTime());
const currentPage = 1;
const totalPages = Math.max(1, Math.ceil(allPosts.length / PER_PAGE));
const posts = allPosts.slice(0, PER_PAGE);
const pages = Array.from({ length: totalPages }, (_, i) => i + 1);
const [featured, ...rest] = posts;
const pageTitle = 'Blog';
const pageDescription = 'Discover articles about kundalini yoga, meditation, sound therapy, sacred rituals, and holistic wellness. Guides and tips for your personal transformation.';
const canonical = new URL(Astro.url).toString();

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://marceanahata.com/en"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": canonical
    }
  ]
};
---

<Layout title={pageTitle} description={pageDescription} lang={lang}>
  <head>
    <script type="application/ld+json">{JSON.stringify(breadcrumbSchema)}</script>
    <link rel="canonical" href={canonical} />
  </head>
  <h1 class="text-3xl font-bold mb-4">{t('nav.blog')}</h1>
  <div class="mb-4 flex items-center gap-4">
    <p>{pageDescription}</p>
    <a href="/en/blog/rss.xml" class="text-[#243c5a] underline text-sm" target="_blank" rel="noopener">RSS</a>
  </div>
  <div class="space-y-8">
    {posts.length === 0 && <p>No blog posts found.</p>}
    {posts.map(post => (
      <article class="border-b pb-6 mb-6" key={post.id}>
        <h2 class="text-2xl font-semibold mb-2">
          <a href={`/en/blog/${post.slug.replace(/^en\//, '')}`} class="hover:underline text-[#243c5a]">{post.data.title}</a>
        </h2>
        <p class="text-stone-600 mb-2">{post.data.description}</p>
        <p class="text-xs text-stone-400">{new Date(post.data.pubDate || post.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
      </article>
    ))}
  </div>
  {totalPages > 1 && (
    <nav class="flex gap-2 mt-8 justify-center" aria-label="Pagination">
      {pages.map(page => (
        <a
          href={page === 1 ? '/en/blog' : `/en/blog/page/${page}`}
          class="px-3 py-1 rounded-full border text-sm font-medium transition-colors hover:bg-[#243c5a] hover:text-white"
          style={page === currentPage ? 'background:#243c5a;color:white;' : ''}
        >
          {page}
        </a>
      ))}
    </nav>
  )}
</Layout>

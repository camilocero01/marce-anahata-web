---
import Layout from '../../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  // Obtener todos los tags únicos de los posts en inglés
  const posts = await getCollection('blog', ({ data, slug }) => !data.draft && slug.startsWith('en/'));
  const tags = Array.from(new Set(posts.flatMap((post) => post.data.tags || [])));
  return tags.map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;
const lang = 'en';
const posts = (await getCollection('blog', ({ data, slug }) => !data.draft && slug.startsWith('en/') && (data.tags || []).includes(tag)))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const pageTitle = `Posts tagged “${tag}”`;
const description = `All blog posts tagged with “${tag}” in English.`;
---
<Layout title={pageTitle} description={description} lang={lang}>
  <main class="max-w-3xl mx-auto px-4 py-16">
    <a href="/en/blog" class="text-sm text-[#243c5a] hover:underline">← Back to blog</a>
    <h1 class="text-3xl font-serif text-[#243c5a] mb-8 mt-4">{pageTitle}</h1>
    {posts.length === 0 ? (
      <p class="text-stone-600">No posts found for this tag.</p>
    ) : (
      <ul class="space-y-8">
        {posts.map((post) => (
          <li>
            <a href={`/en/blog/${post.slug.replace(/^en\//, '')}`} class="block group">
              <h2 class="text-xl font-bold text-[#243c5a] group-hover:text-[#6ed8d9] mb-1">{post.data.title}</h2>
              <p class="text-stone-600 text-sm mb-1">{post.data.description}</p>
              <time class="text-xs text-stone-400">{new Date(post.data.pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</time>
            </a>
          </li>
        ))}
      </ul>
    )}
  </main>
</Layout>

---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const tagCounts = new Map<string, number>();
posts.forEach(p => (p.data.tags || []).forEach(t => tagCounts.set(t, (tagCounts.get(t) || 0) + 1)));
const tags = Array.from(tagCounts.entries()).sort((a, b) => b[1] - a[1]);

const pageTitle = 'Tags del Blog';
const pageDescription = 'Explora artículos sobre yoga, meditación, terapia de sonido, rituales sagrados y bienestar integral. Organiza el contenido por temas de kundalini yoga, sanación, mindfulness y transformación personal.';
const canonical = new URL(Astro.url).toString();
---

<Layout title={pageTitle} description={pageDescription}>
  <Fragment slot="head">
    <link rel="canonical" href={canonical} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/images/social-preview.jpg" />
  </Fragment>
  <main class="max-w-5xl mx-auto px-4 py-16">
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-serif text-[#243c5a] mb-4">Explora por Tags</h1>
      <p class="text-stone-600 text-lg">Descubre nuestros artículos sobre kundalini yoga, meditación, terapia de sonido, rituales sagrados y bienestar. Navega por categorías de mindfulness, sanación energética y transformación personal para encontrar exactamente lo que buscas.</p>
      <div class="mt-6">
        <a href="/blog" class="text-sm text-[#243c5a] hover:underline">← Volver al blog</a>
      </div>
    </div>

    {tags.length === 0 ? (
      <p class="text-center text-stone-500">No hay tags disponibles.</p>
    ) : (
      <ul class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {tags.map(([t, count]) => (
          <li>
            <a href={`/blog/tag/${encodeURIComponent(t)}`} class="flex items-center justify-between bg-white border border-stone-100 rounded-xl px-4 py-3 hover:shadow-md transition-shadow">
              <span class="text-[#243c5a] font-medium">#{t}</span>
              <span class="text-stone-500 text-sm">{count}</span>
            </a>
          </li>
        ))}
      </ul>
    )}
  </main>
</Layout>

---
// Newsletter Component - English Version
// Maintains the same structure as the Spanish version with SEO best practices
export interface Props {
  title?: string;
  description?: string;
  compact?: boolean;
}

const {
  title = "Stay Updated on Yoga, Meditation & Wellness",
  description = "Receive exclusive tips, new blog articles, and be the first to know about our special events and promotions.",
  compact = false
} = Astro.props;
---

<div class={`newsletter-section ${compact ? 'compact' : 'full'}`}>
  <div class={`${compact ? 'max-w-2xl' : 'max-w-3xl'} mx-auto ${compact ? '' : 'text-center'}`}>
    <h3 class={`font-serif font-bold text-[#243c5a] mb-3 ${compact ? 'text-xl' : 'text-2xl md:text-3xl'}`}>
      {title}
    </h3>
    {!compact && (
      <p class="text-stone-600 mb-6 max-w-xl mx-auto">
        {description}
      </p>
    )}
    
    <form 
      id="newsletter-form-en"
      class="flex flex-col sm:flex-row gap-3 mb-4"
      aria-label="Newsletter subscription form"
    >
      <input 
        type="email" 
        name="email"
        placeholder="your@email.com"
        required
        class="flex-1 px-4 py-3 rounded-lg border-2 border-stone-200 focus:border-[#6ed8d9] focus:outline-none placeholder:text-stone-400 transition-colors"
        aria-label="Your email address"
      />
      <button 
        type="submit"
        id="newsletter-btn-en"
        class="px-6 py-3 bg-[#6ed8d9] text-[#243c5a] rounded-lg font-semibold hover:bg-[#5ac5c6] transition-all shadow-md hover:shadow-lg whitespace-nowrap"
      >
        Subscribe
      </button>
    </form>

    <div id="form-message-en" class="text-sm text-stone-500" role="status" aria-live="polite"></div>

    <p class="text-xs text-stone-400 mt-4">
      We don't share your email with anyone. You can unsubscribe at any time.
    </p>
  </div>
</div>

<style>
  .newsletter-section.compact {
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(110, 216, 217, 0.05) 0%, rgba(93, 90, 140, 0.05) 100%);
    border-radius: 0.75rem;
    border: 1px solid rgba(110, 216, 217, 0.2);
  }

  .newsletter-section.full {
    padding: 2rem;
    background: linear-gradient(to bottom, #f1f5f9, #ffffff);
    border-top: 2px solid #e2e8f0;
    border-bottom: 2px solid #e2e8f0;
  }
</style>

<script>
  const form = document.getElementById('newsletter-form-en');
  const messageDiv = document.getElementById('form-message-en');
  const submitBtn = document.getElementById('newsletter-btn-en');

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const emailInput = form.querySelector('input[name="email"]');
      const email = emailInput.value;
      const originalText = submitBtn?.textContent || 'Subscribe';

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Subscribing...';
      }
      if (messageDiv) {
        messageDiv.textContent = '';
        messageDiv.className = 'text-sm text-stone-500';
      }

      try {
        const formData = new FormData();
        formData.append('email', email);

        const response = await fetch('https://formspree.io/f/mgovwznp', {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        const data = await response.json();

        if (response.ok) {
          if (messageDiv) {
            messageDiv.innerHTML = 'âœ“ Thank you for subscribing! I\'m honored to have a space in your inbox. You\'re now on the list to receive my new articles, reflections, and exclusive dates for upcoming events and workshops. Looking forward to connecting with you. NamastÃ¨. ðŸ™';
            messageDiv.className = 'text-sm text-green-600 font-semibold mt-2';
          }
          
          form.reset();
          
          if (submitBtn) {
            setTimeout(() => {
              submitBtn.disabled = false;
              submitBtn.textContent = originalText;
              if (messageDiv) {
                messageDiv.textContent = '';
                messageDiv.className = 'text-sm text-stone-500';
              }
            }, 20000);
          }
        } else {
          const errors = data.errors || [];
          const errorMessage = errors.length > 0 
            ? errors.map(err => err.message).join(', ')
            : 'Error processing subscription';
          throw new Error(errorMessage);
        }
      } catch (error) {
        console.error('Newsletter error:', error);
        
        if (messageDiv) {
          messageDiv.innerHTML = 'âœ— There was an error. Please check your email and try again.';
          messageDiv.className = 'text-sm text-red-600 font-semibold mt-2';
        }
        
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }

        setTimeout(() => {
          if (messageDiv) {
            messageDiv.textContent = '';
            messageDiv.className = 'text-sm text-stone-500';
          }
        }, 10000);
      }
    });
  }
</script>

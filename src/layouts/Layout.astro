---
import '../styles/global.css';
import '@fontsource/montserrat/400.css';
import '@fontsource/montserrat/700.css';
import { Image } from 'astro:assets';
import logoImg from '../assets/logo.svg';
import CookieConsent from '../components/CookieConsent.astro';
import Newsletter from '../components/Newsletter.astro';
import NewsletterEN from '../components/NewsletterEN.astro';
import Analytics from '@vercel/analytics/astro';
import LanguagePicker from '../components/LanguagePicker.astro';
import { useTranslations } from '../i18n/ui';


const langProp = (Astro.props.lang as string) || 'es';
const t = useTranslations(langProp);

interface Props {
    title: string;
    description?: string;
    image?: string;
    logo?: string;
    ogType?: string;
    hideAuthorInTitle?: boolean;
    lang?: string;
}

const {
    title,
    description = "Centro de bienestar Marce Anahata en El Poblado en Medell√≠n - El Poblado. Kundalini Yoga, Terapia de Sonido, Rituales Sagrados y Bienestar Corporativo.",
    image = "/images/social-preview-wa.jpg" ,
    logo = "/images/marce-perfil.webp",
    ogType = 'website',
    hideAuthorInTitle = false,
    lang = 'es',
} = Astro.props as Props;

const finalTitle = hideAuthorInTitle ? title : `${title} | Marce Anahata`;
const siteUrl = Astro.site ?? new URL('https://www.marceanahata.com');
const resolvedImage = image?.startsWith('http') ? image : new URL(image, siteUrl).toString();
const resolvedLogo = logo?.startsWith('http') ? logo : new URL(logo, siteUrl).toString();

const normalizedPath = Astro.url.pathname !== '/' && Astro.url.pathname.endsWith('/')
    ? Astro.url.pathname.slice(0, -1)
    : Astro.url.pathname;
const isEnPath = normalizedPath.startsWith('/en');
const baseEsPath = isEnPath ? normalizedPath.replace(/^\/en/, '') || '/' : normalizedPath || '/';

const enPathOverrides: Record<string, string> = {
    '/': '/en/',
    '/nosotros': '/en/about',
    '/sobre-mi': '/en/sobre-mi',
    '/clases': '/en/clases',
    '/terapia-sonido': '/en/terapia-sonido',
    '/rituales': '/en/rituales',
    '/bienestar-corporativo': '/en/bienestar-corporativo',
    '/contacto': '/en/contacto',
    '/faq': '/en/faq',
    '/tarifas': '/en/tarifas',
    '/buscar': '/en/buscar',
    '/blog': '/en/blog',
    '/ritual-baby-blessing': '/en/ritual-baby-blessing',
    '/ritual-cierre-apertura': '/en/ritual-cierre-apertura',
    '/ritual-cumpleanos': '/en/ritual-cumpleanos',
    '/ritual-despedida-soltera': '/en/ritual-despedida-soltera',
    '/ritual-pareja': '/en/ritual-pareja',
};

const getEnPath = (path: string) => {
    if (enPathOverrides[path]) return enPathOverrides[path];
    if (path.startsWith('/blog/')) return `/en${path}`;
    if (path.startsWith('/ritual-')) return `/en${path}`;
    return null;
};

const resolvedEsPath = isEnPath ? baseEsPath : normalizedPath || '/';
const resolvedEnPath = isEnPath ? normalizedPath : getEnPath(baseEsPath);
const resolvedEsUrl = new URL(resolvedEsPath, siteUrl).toString();
const resolvedEnUrl = resolvedEnPath ? new URL(resolvedEnPath, siteUrl).toString() : null;

// Schema.org para SEO Local (Negocio Local)
const schema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "HealthAndBeautyBusiness",
    "name": "Marce Anahata Centro de Bienestar",
    "image": resolvedImage,
  "description": description,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Cl. 11A Sur #46-12, La Aguacatala",
    "addressLocality": "Medell√≠n",
    "addressRegion": "Antioquia",
    "postalCode": "050012",
    "addressCountry": "CO"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 6.1955152,
    "longitude": -75.5779584
  },
    "url": siteUrl.toString(),
  "telephone": "+573207329921",
  "email": "info@marceanahata.com",
  "priceRange": "70000-500000 COP",
  "areaServed": {
    "@type": "City",
    "name": "Medell√≠n"
  },
  "knowsAbout": ["Kundalini Yoga", "Terapia de Sonido", "Meditaci√≥n", "Rituales Sagrados", "Bienestar Corporativo"],
    "sameAs": [
        "https://instagram.com/marce_anahata",
        "https://wa.me/573207329921"
    ]
});

// Organization schema para visibilidad general
const orgSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Organization",
    "name": "Marce Anahata",
    "url": siteUrl.toString(),
        "logo": new URL('/favicon.png', siteUrl).toString(),
  "description": "Centro de bienestar integral con Kundalini Yoga, Terapia de Sonido, Rituales Sagrados y Bienestar Corporativo en Medell√≠n.",
  "foundingDate": "2020",
  "foundingLocation": "Medell√≠n, Colombia",
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "Customer Support",
    "telephone": "+573207329921",
    "email": "info@marceanahata.com"
  },
  "sameAs": [
    "https://instagram.com/marce_anahata",
    "https://wa.me/573207329921"
  ]
});
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/png" href="/favicon.png" />
        <link rel="icon" href="/favicon.ico" sizes="any" />
        <!-- Si tienes manifest: <link rel="manifest" href="/site.webmanifest" /> -->
        <meta name="generator" content={Astro.generator} />

        <title>{finalTitle}</title>
        <meta name="description" content={description} />
        <meta name="robots" content="index, follow" />
        <link rel="canonical" href={`${siteUrl}${normalizedPath || '/'}`} />
        <link rel="sitemap" href="/sitemap-index.xml" />
        <link rel="alternate" hreflang="es-CO" href={resolvedEsUrl} />
        {resolvedEnUrl && <link rel="alternate" hreflang="en" href={resolvedEnUrl} />}
        <link rel="alternate" hreflang="x-default" href={resolvedEsUrl} />

        <meta name="theme-color" content="#243c5a" />
        <meta property="og:locale" content="es_CO" />
        {resolvedEnUrl && <meta property="og:locale:alternate" content="en_US" />}
        <meta property="fb:app_id" content="1234567890" />

        <!-- Performance: Preload critical resources -->
        <link rel="preload" as="image" href="/images/social-preview-wa.jpg" fetchpriority="high" />
        <!-- Fonts are imported via @fontsource, no need for manual preload -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={resolvedImage} />
        <meta name="twitter:image:alt" content={title} />

        <meta property="og:type" content={ogType} />
        <meta property="og:url" content={Astro.url} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={resolvedImage} />
        <meta property="og:image:secure_url" content={resolvedImage} />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="634" />
        <meta property="og:image:type" content="image/jpeg" />
        <meta property="og:image:alt" content={title} />
        <meta property="og:logo" content={resolvedLogo} />

        <link rel="alternate" type="application/rss+xml" title="Blog RSS" href="/rss.xml" />

        <slot name="head" />

        <!-- Performance: Preconnect to external resources -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="dns-prefetch" href="https://www.googletagmanager.com">
        <link rel="preconnect" href="https://www.googletagmanager.com">

        <script type="application/ld+json" set:html={schema} />
        <script type="application/ld+json" set:html={orgSchema} />

        <!-- Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-N2S592YWN3"></script>
        <script is:inline>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-N2S592YWN3', {
                anonymize_ip: true,
                cookie_flags: 'SameSite=None;Secure'
            });
        </script>

        <!-- WhatsApp CTA Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const link = e.target.closest('[data-event="whatsapp_click"]');
                if (link && window.gtag) {
                    const label = link.getAttribute('data-label') || 'Unknown';
                    const page = link.getAttribute('data-page') || document.location.pathname;
                    
                    window.gtag('event', 'whatsapp_cta_click', {
                        'event_category': 'engagement',
                        'event_label': label,
                        'page_path': page,
                        'timestamp': new Date().toISOString()
                    });
                }
            });
        </script>

        <!-- Pricing Page Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const link = e.target.closest('[data-event="pricing_click"]');
                if (link && window.gtag) {
                    const label = link.getAttribute('data-label') || 'Unknown';
                    const page = link.getAttribute('data-page') || document.location.pathname;
                    
                    window.gtag('event', 'pricing_page_click', {
                        'event_category': 'engagement',
                        'event_label': label,
                        'page_path': page
                    });
                }
            });
        </script>

        <!-- Newsletter Subscription Tracking -->
        <script is:inline>
            document.addEventListener('submit', (e) => {
                const form = e.target.closest('[data-event="newsletter_signup"]');
                if (form && window.gtag) {
                    const page = form.getAttribute('data-page') || document.location.pathname;
                    
                    window.gtag('event', 'newsletter_signup', {
                        'event_category': 'lead',
                        'event_label': 'Newsletter Subscription',
                        'page_path': page,
                        'value': 1
                    });
                }
            });
        </script>

        <!-- Gallery & Carousel Interaction Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const galleryItem = e.target.closest('[data-event="gallery_click"]');
                if (galleryItem && window.gtag) {
                    const label = galleryItem.getAttribute('data-label') || 'Gallery Image';
                    const gallery = galleryItem.getAttribute('data-gallery') || 'Unknown Gallery';
                    
                    window.gtag('event', 'gallery_image_click', {
                        'event_category': 'engagement',
                        'event_label': label,
                        'gallery_name': gallery,
                        'page_path': document.location.pathname
                    });
                }

                const carouselBtn = e.target.closest('[data-event="carousel_nav"]');
                if (carouselBtn && window.gtag) {
                    const direction = carouselBtn.getAttribute('data-direction') || 'unknown';
                    const carouselId = carouselBtn.getAttribute('data-carousel-id') || 'Unknown Carousel';
                    
                    window.gtag('event', 'carousel_navigation', {
                        'event_category': 'engagement',
                        'event_label': `${carouselId} - ${direction}`,
                        'carousel_id': carouselId,
                        'direction': direction,
                        'page_path': document.location.pathname
                    });
                }
            });
        </script>

        <!-- FAQ Accordion Tracking -->
        <script is:inline>
            document.addEventListener('toggle', (e) => {
                const details = e.target.closest('[data-event="faq_open"]');
                if (details && window.gtag && details.tagName === 'DETAILS') {
                    const question = details.getAttribute('data-label') || 'Unknown FAQ';
                    const state = details.open ? 'opened' : 'closed';
                    
                    window.gtag('event', 'faq_interaction', {
                        'event_category': 'engagement',
                        'event_label': question,
                        'faq_action': state,
                        'page_path': document.location.pathname
                    });
                }
            }, true);
        </script>

        <!-- Language Switcher Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const langLink = e.target.closest('[data-event="language_switch"]');
                if (langLink && window.gtag) {
                    const language = langLink.getAttribute('data-language') || 'unknown';
                    
                    window.gtag('event', 'language_switch', {
                        'event_category': 'engagement',
                        'language': language,
                        'page_path': document.location.pathname
                    });
                }
            });
        </script>

        <!-- External Links Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const extLink = e.target.closest('[data-event="external_link"]');
                if (extLink && window.gtag) {
                    const url = extLink.href || extLink.getAttribute('data-url') || 'unknown';
                    const label = extLink.getAttribute('data-label') || new URL(url).hostname;
                    const linkType = extLink.getAttribute('data-link-type') || 'external';
                    
                    window.gtag('event', 'external_link_click', {
                        'event_category': 'engagement',
                        'event_label': label,
                        'link_url': url,
                        'link_type': linkType,
                        'page_path': document.location.pathname
                    });
                }
            });
        </script>

        <!-- Scroll Depth Tracking -->
        <script is:inline>
            let scrollDepthTracked = new Set();
            
            window.addEventListener('scroll', () => {
                if (!window.gtag) return;
                
                const windowHeight = window.innerHeight;
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight;
                
                const scrollPercent = Math.round((scrollTop + windowHeight) / docHeight * 100);
                
                const checkpoints = [25, 50, 75, 100];
                
                checkpoints.forEach(checkpoint => {
                    if (scrollPercent >= checkpoint && !scrollDepthTracked.has(checkpoint)) {
                        scrollDepthTracked.add(checkpoint);
                        
                        window.gtag('event', 'scroll_depth', {
                            'event_category': 'engagement',
                            'scroll_depth_threshold': checkpoint,
                            'page_path': document.location.pathname
                        });
                    }
                });
            }, { passive: true });
        </script>

        <!-- Events Timeline Tracking -->
        <script is:inline>
            document.addEventListener('click', (e) => {
                const eventLink = e.target.closest('[data-event="event_click"]');
                if (eventLink && window.gtag) {
                    const label = eventLink.getAttribute('data-label') || 'Unknown Event';
                    
                    window.gtag('event', 'event_click', {
                        'event_category': 'events',
                        'event_label': label,
                        'page_path': document.location.pathname,
                        'timestamp': new Date().toISOString()
                    });
                }

                const eventCTA = e.target.closest('[data-event="events_cta_click"]');
                if (eventCTA && window.gtag) {
                    const label = eventCTA.getAttribute('data-label') || 'Unknown CTA';
                    
                    window.gtag('event', 'events_cta_click', {
                        'event_category': 'events',
                        'event_label': label,
                        'page_path': document.location.pathname,
                        'timestamp': new Date().toISOString()
                    });
                }
            });
        </script>

    </head>
    <body class="bg-stone-50 text-stone-800 font-sans flex flex-col min-h-screen">

        <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

        <nav class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-b border-stone-100 z-50 transition-all duration-300">
            <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
                <a href={lang === 'en' ? '/en/' : '/'} class="flex items-center gap-3 group">
                    <Image src={logoImg} alt="Logo Marce Anahata" class="h-10 w-auto group-hover:scale-105 transition-transform" width={40} />
                    <span class="flex flex-col leading-tight">
                        <span class="font-serif text-xl text-[#243c5a] group-hover:text-[#6ed8d9] transition-colors">MARCE ANAHATA</span>
                        <span class="text-xs text-[#5d5a8c] -mt-0.5 tracking-wider">Centro de bienestar</span>
                    </span>
                </a>

                <div class="hidden md:flex gap-8 items-center">
                    <a href={lang === 'en' ? '/en/' : '/'} class="text-sm font-medium text-stone-600 hover:text-[#243c5a] transition-colors">{t('nav.home')}</a>
                    <a href={lang === 'en' ? '/en/blog' : '/blog'} class="text-sm font-medium text-stone-600 hover:text-[#243c5a] transition-colors">{t('nav.blog')}</a>
                    <!-- Dropdown Servicios -->
                    <div class="relative group">
                        <button class="text-sm font-medium text-stone-600 hover:text-[#243c5a] transition-colors flex items-center gap-1">
                            {t('nav.services')}
                            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="absolute top-full left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-stone-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href={lang === 'en' ? '/en/clases' : '/clases'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors first:rounded-t-lg">{t('nav.yoga')}</a>
                            <a href={lang === 'en' ? '/en/terapia-sonido' : '/terapia-sonido'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors">{t('nav.sound')}</a>
                            <a href={lang === 'en' ? '/en/rituales' : '/rituales'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors">{t('nav.rituals')}</a>
                            <a href={lang === 'en' ? '/en/bienestar-corporativo' : '/bienestar-corporativo'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors last:rounded-b-lg">{t('nav.corporate')}</a>
                        </div>
                    </div>
                    <a href={lang === 'en' ? '/en/sobre-mi' : '/sobre-mi'} class="text-sm font-medium text-stone-600 hover:text-[#243c5a] transition-colors">{t('nav.aboutme')}</a>
                    <!-- Dropdown Nosotros -->
                    <div class="relative group">
                        <button class="text-sm font-medium text-stone-600 hover:text-[#243c5a] transition-colors flex items-center gap-1">
                            {t('nav.about')}
                            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="absolute top-full left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-stone-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href={lang === 'en' ? '/en/faq' : '/faq'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors">{t('nav.faq')}</a>
                            <a href={lang === 'en' ? '/en/tarifas' : '/tarifas'} data-event="pricing_click" data-label="Nav - Pricing Link" class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors last:rounded-b-lg">{t('nav.prices')}</a>
                            <a href={lang === 'en' ? '/en/contacto' : '/contacto'} class="block px-4 py-3 text-sm text-stone-700 hover:bg-stone-50 hover:text-[#243c5a] transition-colors last:rounded-b-lg">{t('nav.cta')}</a>
                        </div>
                    </div>
                    <LanguagePicker />
                </div>

                <details class="md:hidden group relative">
                    <summary 
                        class="cursor-pointer p-2 list-none"
                        aria-label="Abrir men√∫ de navegaci√≥n"
                        aria-expanded="false"
                    >
                        <svg class="w-7 h-7 text-[#243c5a]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg>
                    </summary>
                    <nav aria-label="Men√∫ principal mobile" class="absolute right-0 top-full mt-2 w-56 bg-white rounded-xl shadow-xl border border-stone-100 p-4 flex flex-col gap-3 z-50">
                        <a href={lang === 'en' ? '/en/' : '/'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.home')}</a>
                        <a href={lang === 'en' ? '/en/blog' : '/blog'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.blog')}</a>
                        <div class="border-t border-stone-100 pt-3">
        <p class="text-xs font-semibold text-stone-400 uppercase tracking-wide mb-2">{t('nav.services')}</p>
        <div class="flex flex-col gap-2 pl-2">
            <a href={lang === 'en' ? '/en/clases' : '/clases'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.yoga')}</a>
            <a href={lang === 'en' ? '/en/terapia-sonido' : '/terapia-sonido'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.sound')}</a>
            <a href={lang === 'en' ? '/en/rituales' : '/rituales'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.rituals')}</a>
            <a href={lang === 'en' ? '/en/bienestar-corporativo' : '/bienestar-corporativo'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.corporate')}</a>
        </div>
    </div>
    <hr class="border-stone-100">
    <a href={lang === 'en' ? '/en/sobre-mi' : '/sobre-mi'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.aboutme')}</a>
    <div class="border-t border-stone-100 pt-3">
        <p class="text-xs font-semibold text-stone-400 uppercase tracking-wide mb-2">{t('nav.about')}</p>
        <div class="flex flex-col gap-2 pl-2">
            <a href={lang === 'en' ? '/en/contacto' : '/contacto'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.cta')}</a>
            <a href={lang === 'en' ? '/en/faq' : '/faq'} class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.faq')}</a>
            <a href={lang === 'en' ? '/en/tarifas' : '/tarifas'} data-event="pricing_click" data-label="Footer - Pricing Link" class="text-stone-700 hover:text-[#6ed8d9]">{t('nav.prices')}</a>
        </div>
    </div>
    <hr class="border-stone-100">
    <div class="mt-2"><LanguagePicker /></div>
                    </nav>
                </details>

                <script is:inline>
                    const details = document.querySelector('details');
                    const summary = details?.querySelector('summary');
                    
                    if (details && summary) {
                        details.addEventListener('toggle', () => {
                            summary.setAttribute('aria-expanded', details.open ? 'true' : 'false');
                        });
                    }
                </script>
            </div>
        </nav>

        <main id="main-content" class="flex-grow pt-20">
            <slot />
        </main>

        <!-- Newsletter Section -->
        <section class="py-12 px-4 bg-gradient-to-b from-white to-stone-50">
            {langProp === 'en' ? (
                <NewsletterEN
                    title="Stay Updated on Yoga, Meditation & Wellness"
                    description="Receive exclusive tips, new blog articles, and be the first to know about our special events and promotions."
                />
            ) : (
                <Newsletter
                    title="Recibe actualizaciones y eventos exclusivos"
                    description="Suscr√≠bete a nuestro newsletter para recibir art√≠culos nuevos, eventos especiales y ofertas exclusivas directamente en tu email."
                />
            )}
        </section>

        <footer class="bg-[#243c5a] text-stone-100 py-16 border-t-4 border-[#6ed8d9]">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">

                    <div>
                        <div class="flex items-center gap-2 mb-6">
                            <span class="font-serif text-2xl text-white tracking-wide">MARCE ANAHATA</span>
                        </div>
                        <p class="text-sm leading-relaxed text-stone-200 mb-6">
                            Espacios sagrados para la transformaci√≥n personal a trav√©s del Kundalini Yoga, el sonido y la conciencia.
                        </p>
                        <div class="flex gap-4">
                            <a href="https://instagram.com/marce_anahata" target="_blank" aria-label="Instagram" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-[#6ed8d9] hover:text-[#243c5a] transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                            </a>
                            <a href="https://wa.me/573207329921" target="_blank" aria-label="WhatsApp" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-[#6ed8d9] hover:text-[#243c5a] transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                            </a>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-white font-serif text-lg mb-6">{t('footer.explore')}</h3>
                        <ul class="space-y-3 text-sm">
                            <li><a href={lang === 'en' ? '/en/' : '/'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.home')}</a></li>
                            <li><a href={lang === 'en' ? '/en/blog' : '/blog'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.blog')}</a></li>
                            <li><a href={lang === 'en' ? '/en/sobre-mi' : '/sobre-mi'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.aboutme')}</a></li>
                            <li><a href={lang === 'en' ? '/en/faq' : '/faq'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.faq')}</a></li>
                            <li><a href={lang === 'en' ? '/en/tarifas' : '/tarifas'} data-event="pricing_click" data-label="Mobile Menu - Pricing Link" class="hover:text-[#6ed8d9] transition-colors">{t('nav.prices')}</a></li>
                            <li><a href={lang === 'en' ? '/en/contacto' : '/contacto'} class="hover:text-[#6ed8d9] transition-colors">{t('footer.contact')}</a></li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-white font-serif text-lg mb-6">{t('footer.services')}</h3>
                        <ul class="space-y-3 text-sm">
                            <li><a href={lang === 'en' ? '/en/clases' : '/clases'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.yoga')}</a></li>
                            <li><a href={lang === 'en' ? '/en/terapia-sonido' : '/terapia-sonido'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.sound')}</a></li>
                            <li><a href={lang === 'en' ? '/en/bienestar-corporativo' : '/bienestar-corporativo'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.corporate')}</a></li>
                            <li><a href={lang === 'en' ? '/en/rituales' : '/rituales'} class="hover:text-[#6ed8d9] transition-colors">{t('nav.rituals')}</a></li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-white font-serif text-lg mb-6">{t('footer.visit')}</h3>
                        <ul class="space-y-4 text-sm">
                            <li class="flex items-start gap-3">
                                <span class="text-[#6ed8d9] mt-1">üìç</span>
                                <span>{t('footer.address')}<br><span class="text-stone-400 text-xs">Atenci√≥n con cita previa</span></span>
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="text-[#6ed8d9]">üì±</span>
                                <a href="https://wa.me/573207329921" class="hover:text-white transition-colors">+57 320 732 9921</a>
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="text-[#6ed8d9]">‚úâÔ∏è</span>
                                <a href="mailto:hola@marceanahata.com" class="hover:text-white transition-colors">info@marceanahata.com</a>
                            </li>
                        </ul>
                    </div>

                </div>

                <div class="border-t border-white/10 pt-8 text-center text-xs text-stone-400 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p>¬© {new Date().getFullYear()} Marce Anahata. Todos los derechos reservados.
                        <a href="/privacidad" class="hover:text-white transition-colors underline decoration-dotted">
                            Pol√≠tica de Privacidad
                        </a>
                    </p>
                    <p>Dise√±ado con consciencia.</p>
                </div>
            </div>
        </footer>

        <div class="hidden md:block fixed bottom-24 right-6 z-50 w-72 rounded-2xl bg-white/95 shadow-2xl border border-stone-200/80 backdrop-blur" data-wa-panel>
            <div class="px-4 py-3 border-b border-stone-200/70 flex items-center justify-between">
                <div>
                    <p class="text-sm font-semibold text-stone-800">Chatea por WhatsApp</p>
                    <p class="text-xs text-stone-500">Respuesta en horario h√°bil</p>
                </div>
                <div class="flex items-center gap-2">
                    <span aria-hidden="true" class="text-[#25D366] text-lg">‚óè</span>
                    <button type="button" class="text-stone-400 hover:text-stone-600 transition" aria-label="Cerrar horarios de WhatsApp" data-wa-close>
                        √ó
                    </button>
                </div>
            </div>
            <div class="px-4 py-3">
                <p class="text-xs font-semibold text-stone-700 uppercase tracking-wide mb-1">Horarios de atenci√≥n</p>
                <ul class="text-sm text-stone-600 space-y-1">
                    <li>Lunes a S√°bado: 8:00 - 20:00</li>
                    <li>Domingo y festivos: cerrado</li>
                </ul>
                <a
                    href="https://wa.me/573207329921?text=Hola%20Marce%20Anahata,%20estaba%20visitando%20tu%20sitio%20y%20me%20gustar√≠a%20m√°s%20informaci√≥n..."
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-4 inline-flex w-full items-center justify-center gap-2 rounded-xl bg-[#25D366] px-3 py-2 text-white text-sm font-semibold shadow-md transition hover:shadow-lg hover:scale-[1.01]"
                    aria-label="Abrir chat de WhatsApp"
                >
                    Iniciar chat
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                </a>
            </div>
        </div>

        <a
        href="https://wa.me/573207329921?text=Hola%20Marce%20Anahata,%20estaba%20visitando%20tu%20sitio%20y%20me%20gustar√≠a%20m√°s%20informaci√≥n..."
        target="_blank"
        rel="noopener noreferrer"
        class="fixed bottom-6 right-6 z-50 bg-[#25D366] text-white p-4 rounded-full shadow-lg hover:scale-110 transition-transform duration-300 hover:shadow-xl flex items-center justify-center"
        aria-label="Contactar por WhatsApp"
        >
        <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
        </svg>
        </a>

        <script is:inline>
            (() => {
                if (typeof window === 'undefined') return;

                const panel = document.querySelector('[data-wa-panel]');
                const closeBtn = document.querySelector('[data-wa-close]');
                const storageKey = 'waHoursClosed';
                let waLoaded = false;

                const safeGet = () => {
                    try { return window.localStorage.getItem(storageKey); } catch (err) { return null; }
                };

                const safeSet = (value) => {
                    try { window.localStorage.setItem(storageKey, value); } catch (err) { /* ignore */ }
                };

                const showWAPanel = () => {
                    if (!panel) return;
                    if (safeGet() === '1') {
                        panel.style.display = 'none';
                        panel.classList.add('hidden');
                        return;
                    }
                    panel.style.display = '';
                    panel.classList.remove('hidden');
                    waLoaded = true;
                };

                // Lazy load: Show widget only when user scrolls 30% or after 3s
                let scrollListener = () => {
                    if (window.scrollY > window.innerHeight * 0.3) {
                        showWAPanel();
                        window.removeEventListener('scroll', scrollListener);
                    }
                };

                window.addEventListener('scroll', scrollListener, { passive: true });
                setTimeout(() => {
                    if (!waLoaded) {
                        showWAPanel();
                    }
                }, 3000);

                // Close button handler
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        if (!panel) return;
                        safeSet('1');
                        panel.style.display = 'none';
                        panel.classList.add('hidden');
                    });
                }
            })();
        </script>